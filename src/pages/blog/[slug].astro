---
import Base from "../../layouts/Base.astro";
import Nav from "../../components/Nav.astro";
import Footer from "../../components/Footer.astro";
import Seo from "../../components/Seo.astro";
import { getCollection } from 'astro:content';

// Pre-render dynamic blog pages so getStaticPaths runs during build
export const prerender = true;

export async function getStaticPaths() {
  const posts = await getCollection('blog', ({ data }) => !data.draft);
  return posts.map((post) => ({ params: { slug: post.slug }, props: { post } }));
}

const { post } = Astro.props;
const { Content, headings } = await post.render();
---
<Base title={`${post.data.title} | AIHALO`} description={post.data.description || post.data.title}>
  <Fragment slot="head">
    <Seo
      title={post.data.title}
      description={post.data.description || post.data.title}
      path={`/blog/${post.slug}`}
      type="article"
      article={{ title: post.data.title, description: post.data.description, slug: post.slug, datePublished: post.data.date, image: '/og/default.svg' }}
      breadcrumbs={[{ name: 'Home', url: '/' }, { name: 'Blog', url: '/blog' }, { name: post.data.title, url: `/blog/${post.slug}` }]}
    />
  </Fragment>
  <Fragment slot="nav"><Nav /></Fragment>
  <article class="prose max-w-none">
    <h1 class="text-3xl md:text-4xl font-semibold">{post.data.title}</h1>
    {post.data.date && <p class="text-sm text-slate-500">{post.data.date}</p>}
    <Content />
  </article>
  <Fragment slot="footer"><Footer /></Fragment>
</Base>

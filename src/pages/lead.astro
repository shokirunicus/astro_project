---
import Base from "../layouts/Base.astro";
import Nav from "../components/Nav.astro";
import Footer from "../components/Footer.astro";
import Hero from "../components/Hero.astro";
// Tally埋め込みに切り替え（FormLeadは未使用）
---
<Base title="資料ダウンロード | AIHALO">
  <Fragment slot="nav"><Nav /></Fragment>
  <Hero title="経営者向けAI導入ガイド" subtitle="メール登録でPDFをお送りします">
    <div>
      <div
        id="tally-embed"
        data-tally-src="https://tally.so/r/wA7Xx5?transparentBackground=1&hideTitle=1"
        style="width: 100%; height: 600px;"
      ></div>
      <noscript>
        <p>
          お使いの環境では埋め込みが表示できません。
          <a href="https://tally.so/r/wA7Xx5" target="_blank" rel="noopener">こちら</a>
          からフォームにアクセスしてください。
        </p>
      </noscript>
    </div>
    <script is:inline>
      (function() {
        const el = document.getElementById('tally-embed');
        if (!el) return;
        try {
          const base = el.getAttribute('data-tally-src');
          if (!base) return;
          const u = new URL(base, location.origin);
          const params = new URLSearchParams(location.search);
          const keys = ['utm_source','utm_medium','utm_campaign','utm_content','utm_term'];
          keys.forEach(k => { const v = params.get(k); if (v) u.searchParams.set(k, v); });
          if (document.referrer) u.searchParams.set('ref', document.referrer);
          el.setAttribute('data-tally-src', u.toString());
        } catch (e) { /* noop */ }
        function load() {
          if (window.Tally && typeof window.Tally.loadEmbeds === 'function') { window.Tally.loadEmbeds(); return; }
          const s = document.createElement('script');
          s.src = 'https://tally.so/widgets/embed.js';
          s.async = true;
          s.onload = () => { try { window.Tally.loadEmbeds(); } catch(_){} };
          document.body.appendChild(s);
        }
        load();
      })();
    </script>
  </Hero>
  <Fragment slot="footer"><Footer /></Fragment>
</Base>
